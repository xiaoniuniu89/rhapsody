{{#if isCollapsed}}
  <!-- Collapsed Button State -->
  <div class="rhapsody-button-content" data-action="toggleCollapse">
    <i class="fas fa-robot"></i>
  </div>
{{else}}
  <!-- Expanded Chat State -->
  <header class="window-header flexrow">
    <h4 class="window-title">Rhapsody AI GM</h4>
    <div class="header-buttons">
      <button class="minimize" data-action="toggleCollapse" title="Minimize">
        <i class="fas fa-minus"></i>
      </button>
    </div>
  </header>
  
  <section class="rhapsody-chat-window window-content">
    {{#unless hasApiKey}}
      <div class="api-key-warning">
        <i class="fas fa-exclamation-triangle"></i>
        <p>No OpenAI API key configured!</p>
        <p>Please set your API key in the module settings.</p>
      </div>
    {{/unless}}
    
    <div class="messages-container">
      {{#each messages}}
        <div class="message {{this.role}}">
          <strong>{{#if (eq this.role "user")}}You{{else}}AI GM{{/if}}:</strong>
          <p>{{this.content}}</p>
        </div>
      {{/each}}
    </div>
    
    <form class="message-form" data-action="send">
      <div class="form-group">
        <input type="text" 
               name="message" 
               placeholder="Ask the AI GM something..." 
               {{#unless hasApiKey}}disabled{{/unless}}>
        <button type="submit" 
                {{#unless hasApiKey}}disabled{{/unless}}>
          <i class="fas fa-paper-plane"></i>
        </button>
      </div>
    </form>
  </section>
{{/if}}